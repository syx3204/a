<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime search</title>
    <!-- å¼•å…¥ MDUI CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdui@1.0.2/dist/css/mdui.min.css">
    <style>
        /* è‡ªå®šä¹‰æ ·å¼ */
        .video-container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #000;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        .video-container video {
            width: 100%;
            height: auto;
            display: block;
        }
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .video-container:hover .video-controls {
            opacity: 1;
        }
        .video-controls button {
            background: none;
            border: none;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
        }
        .video-controls button:hover {
            color: #007bff;
        }
        .video-controls input[type="range"] {
            flex: 1;
            height: 5px;
            background-color: #555;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .video-controls input[type="range"]:hover {
            opacity: 1;
        }
        .video-controls input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            background-color: #007bff;
            border-radius: 50%;
            cursor: pointer;
        }
        .video-controls .time {
            color: #fff;
            font-size: 14px;
            margin: 0 10px;
        }
        .episode-list {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .episode-item {
            padding: 10px;
            background-color: #007bff;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
        }
        .episode-item:hover {
            background-color: #0056b3;
        }
        .footer {
            margin-top: 40px;
            padding: 20px;
            background-color: #f5f5f5;
            text-align: center;
        }
        .movie-card {
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s;
        }
        .movie-card:hover {
            transform: translateY(-5px);
        }
    </style>
</head>
<body class="mdui-theme-primary-indigo mdui-theme-accent-pink">
    <!-- å…¬å‘Šæ  -->
    <div class="mdui-container mdui-m-t-2">
        <div class="mdui-alert mdui-alert-info">
            <i class="mdui-icon material-icons">info</i>
            <strong>å…¬å‘Šï¼š</strong>æœ¬ç«™ä»…æä¾›å½±ç‰‡æœç´¢æ’­æ”¾æœåŠ¡ï¼Œä¸æä¾›ä»»ä½•å½±ç‰‡èµ„æºå­˜å‚¨ã€å½•åˆ¶ã€ä¸Šä¼ ç­‰æœåŠ¡ï¼Œä¹Ÿä¸å‚ä¸ä»»ä½•å½±ç‰‡çš„å½•åˆ¶ã€ä¸Šä¼ ç­‰è¡Œä¸ºã€‚å½±ç‰‡ä¸­çš„å¹¿å‘Šéæœ¬ç«™æ‰€ä¸ºï¼Œè¯·å‹¿ç›¸ä¿¡ã€‚å¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»å½±ç‰‡æä¾›æ–¹ã€‚
        </div>
    </div>

    <!-- æœç´¢é¡µ -->
    <div id="search-page" class="mdui-container mdui-m-t-2">
        <div class="mdui-textfield mdui-textfield-floating-label">
            <label class="mdui-textfield-label">è¾“å…¥å½±ç‰‡åç§°</label>
            <input class="mdui-textfield-input" type="text" id="search-input">
        </div>
        <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme" onclick="searchMovies()">æœç´¢</button>
        <div class="mdui-m-t-2" id="error-message"></div>
        <div class="movie-list mdui-m-t-2" id="movie-list">
            <!-- å½±ç‰‡é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- è¯¦æƒ…é¡µ -->
    <div id="detail-page" class="mdui-container mdui-m-t-2" style="display: none;">
        <button class="mdui-btn mdui-btn-raised mdui-ripple mdui-color-theme" onclick="goBack()">è¿”å›</button>
        <div class="video-container mdui-m-t-2" id="video-container">
            <video id="video-player" width="100%" height="auto"></video>
            <div class="video-controls">
                <button id="play-pause-btn">â–¶ï¸</button>
                <input type="range" id="seek-bar" value="0" max="100">
                <span class="time" id="current-time">00:00</span> / <span class="time" id="duration">00:00</span>
                <button id="mute-btn">ğŸ”Š</button>
                <input type="range" id="volume-bar" value="100" max="100">
                <button id="fullscreen-btn">â›¶</button>
            </div>
        </div>
        <div class="movie-detail mdui-m-t-2" id="detail-content">
            <!-- å½±ç‰‡è¯¦æƒ…å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>

    <!-- é¡µè„š -->
    <div class="footer mdui-m-t-4">
        <p>&copy; <span id="year"></span> Anime search. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
        <p>Powered by MDUI.</p>
    </div>

    <!-- å¼•å…¥ MDUI JS -->
    <script src="https://cdn.jsdelivr.net/npm/mdui@1.0.2/dist/js/mdui.min.js"></script>
    <script>
        // è‡ªåŠ¨æ›´æ–°ç‰ˆæƒå¹´ä»½
        document.getElementById('year').textContent = new Date().getFullYear();

        let currentVideo = null; // å½“å‰æ’­æ”¾çš„è§†é¢‘å…ƒç´ 

        // æ¸²æŸ“å½±ç‰‡åˆ—è¡¨
        function renderMovies(movies) {
            const movieList = document.getElementById('movie-list');
            movieList.innerHTML = ''; // æ¸…ç©ºå½“å‰åˆ—è¡¨

            if (!Array.isArray(movies)) {
                showError('è¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                return;
            }

            if (movies.length === 0) {
                showError('æœªæ‰¾åˆ°ç›¸å…³å½±ç‰‡');
                return;
            }

            movies.forEach((movie, index) => {
                const movieItem = document.createElement('div');
                movieItem.className = 'mdui-col-xs-6 mdui-col-sm-4 mdui-col-md-3 mdui-m-b-2';
                movieItem.onclick = () => showMovieDetail(movie.name, index + 1);

                const movieCard = document.createElement('div');
                movieCard.className = 'mdui-card movie-card';

                const movieImage = document.createElement('div');
                movieImage.className = 'mdui-card-media';
                movieImage.style.backgroundImage = `url(${movie.image})`;
                movieImage.style.height = '200px';
                movieImage.style.backgroundSize = 'cover';

                const movieContent = document.createElement('div');
                movieContent.className = 'mdui-card-content';

                const movieName = document.createElement('h3');
                movieName.className = 'mdui-card-primary-title';
                movieName.textContent = movie.name;

                const movieJi = document.createElement('p');
                movieJi.className = 'mdui-card-subtitle';
                movieJi.textContent = `çŠ¶æ€: ${movie.ji}`;

                const movieYear = document.createElement('p');
                movieYear.className = 'mdui-card-subtitle';
                movieYear.textContent = `å¹´ä»½: ${movie.year}`;

                movieContent.appendChild(movieName);
                movieContent.appendChild(movieJi);
                movieContent.appendChild(movieYear);

                movieCard.appendChild(movieImage);
                movieCard.appendChild(movieContent);
                movieItem.appendChild(movieCard);
                movieList.appendChild(movieItem);
            });
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const errorMessage = document.getElementById('error-message');
            errorMessage.textContent = message;
        }

        // æœç´¢åŠŸèƒ½
        function searchMovies() {
            const searchInput = document.getElementById('search-input').value;
            if (!searchInput) {
                showError('è¯·è¾“å…¥æœç´¢å†…å®¹');
                return;
            }

            // è°ƒç”¨API
            fetch(`https://oiapi.net/API/Anime?msg=${encodeURIComponent(searchInput)}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ç½‘ç»œå“åº”å¤±è´¥');
                    }
                    return response.json();
                })
                .then(data => {
                    // æ£€æŸ¥è¿”å›çš„æ•°æ®æ ¼å¼
                    if (data.code === 200 && Array.isArray(data.data)) {
                        renderMovies(data.data); // ä½¿ç”¨ data.data æ¸²æŸ“åˆ—è¡¨
                        showError(''); // æ¸…ç©ºé”™è¯¯ä¿¡æ¯
                    } else {
                        showError('è¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                    }
                })
                .catch(error => {
                    console.error('æœç´¢å¤±è´¥:', error);
                    showError('æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                });
        }

        // æ˜¾ç¤ºå½±ç‰‡è¯¦æƒ…
        function showMovieDetail(movieName, index) {
            // éšè—æœç´¢é¡µï¼Œæ˜¾ç¤ºè¯¦æƒ…é¡µ
            document.getElementById('search-page').style.display = 'none';
            document.getElementById('detail-page').style.display = 'block';

            // è¯·æ±‚å½±ç‰‡è¯¦æƒ…
            fetch(`https://oiapi.net/API/Anime?msg=${encodeURIComponent(movieName)}&type=1&n=${index}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ç½‘ç»œå“åº”å¤±è´¥');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.code === 200 && data.data) {
                        renderMovieDetail(data.data);
                    } else {
                        showError('è·å–å½±ç‰‡è¯¦æƒ…å¤±è´¥');
                    }
                })
                .catch(error => {
                    console.error('è·å–å½±ç‰‡è¯¦æƒ…å¤±è´¥:', error);
                    showError('è·å–å½±ç‰‡è¯¦æƒ…å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                });
        }

        // æ¸²æŸ“å½±ç‰‡è¯¦æƒ…
        function renderMovieDetail(movie) {
            const detailContent = document.getElementById('detail-content');
            detailContent.innerHTML = `
                <h2>${movie.name}</h2>
                <img src="${movie.image}" alt="${movie.name}" style="width: 200px; border-radius: 8px;">
                <p>${movie.desc}</p>
                <p>å¹´ä»½: ${movie.year}</p>
                <p>çŠ¶æ€: ${movie.ji}</p>
                <div class="episode-list" id="episode-list"></div>
            `;

            // æ¸²æŸ“é›†æ•°åˆ—è¡¨
            const episodeList = document.getElementById('episode-list');
            movie.playlist.forEach((episode, index) => {
                const episodeItem = document.createElement('div');
                episodeItem.className = 'episode-item';
                episodeItem.textContent = episode;
                episodeItem.onclick = () => playEpisode(movie.name, index + 1);
                episodeList.appendChild(episodeItem);
            });

            // é»˜è®¤æ’­æ”¾ç¬¬ä¸€é›†
            playEpisode(movie.name, 1);
        }

        // æ’­æ”¾æŸä¸€é›†
        function playEpisode(movieName, episodeIndex) {
            fetch(`https://oiapi.net/API/Anime?msg=${encodeURIComponent(movieName)}&type=1&n=1&j=${episodeIndex}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ç½‘ç»œå“åº”å¤±è´¥');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.code === 200 && data.data) {
                        renderVideo(data.data);
                    } else {
                        showError('è·å–æ’­æ”¾é“¾æ¥å¤±è´¥');
                    }
                })
                .catch(error => {
                    console.error('è·å–æ’­æ”¾é“¾æ¥å¤±è´¥:', error);
                    showError('è·å–æ’­æ”¾é“¾æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                });
        }

        // æ¸²æŸ“è§†é¢‘æ’­æ”¾å™¨
        function renderVideo(videoData) {
            const videoPlayer = document.getElementById('video-player');
            if (currentVideo) {
                currentVideo.pause(); // åœæ­¢å½“å‰è§†é¢‘
            }
            currentVideo = videoPlayer;
            videoPlayer.src = videoData.play_url;
            videoPlayer.play();

            // æ›´æ–°æ’­æ”¾å™¨æ§ä»¶
            const playPauseBtn = document.getElementById('play-pause-btn');
            const seekBar = document.getElementById('seek-bar');
            const muteBtn = document.getElementById('mute-btn');
            const volumeBar = document.getElementById('volume-bar');
            const currentTime = document.getElementById('current-time');
            const duration = document.getElementById('duration');
            const fullscreenBtn = document.getElementById('fullscreen-btn');

            // æ’­æ”¾/æš‚åœæŒ‰é’®
            playPauseBtn.textContent = videoPlayer.paused ? 'â–¶ï¸' : 'â¸ï¸';
            playPauseBtn.onclick = () => {
                if (videoPlayer.paused) {
                    videoPlayer.play();
                    playPauseBtn.textContent = 'â¸ï¸';
                } else {
                    videoPlayer.pause();
                    playPauseBtn.textContent = 'â–¶ï¸';
                }
            };

            // è¿›åº¦æ¡
            seekBar.value = 0;
            videoPlayer.ontimeupdate = () => {
                seekBar.value = (videoPlayer.currentTime / videoPlayer.duration) * 100;
                currentTime.textContent = formatTime(videoPlayer.currentTime);
            };
            seekBar.oninput = () => {
                videoPlayer.currentTime = (seekBar.value / 100) * videoPlayer.duration;
            };

            // è§†é¢‘æ—¶é•¿
            videoPlayer.onloadedmetadata = () => {
                duration.textContent = formatTime(videoPlayer.duration);
            };

            // é™éŸ³æŒ‰é’®
            muteBtn.textContent = videoPlayer.muted ? 'ğŸ”‡' : 'ğŸ”Š';
            muteBtn.onclick = () => {
                videoPlayer.muted = !videoPlayer.muted;
                muteBtn.textContent = videoPlayer.muted ? 'ğŸ”‡' : 'ğŸ”Š';
            };

            // éŸ³é‡æ§åˆ¶
            volumeBar.value = videoPlayer.volume * 100;
            volumeBar.oninput = () => {
                videoPlayer.volume = volumeBar.value / 100;
            };

            // å…¨å±æŒ‰é’®
            fullscreenBtn.onclick = () => {
                if (videoPlayer.requestFullscreen) {
                    videoPlayer.requestFullscreen();
                } else if (videoPlayer.mozRequestFullScreen) {
                    videoPlayer.mozRequestFullScreen();
                } else if (videoPlayer.webkitRequestFullscreen) {
                    videoPlayer.webkitRequestFullscreen();
                } else if (videoPlayer.msRequestFullscreen) {
                    videoPlayer.msRequestFullscreen();
                }
            };
        }

        // æ ¼å¼åŒ–æ—¶é—´ï¼ˆç§’ -> åˆ†:ç§’ï¼‰
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // è¿”å›æœç´¢é¡µ
        function goBack() {
            if (currentVideo) {
                currentVideo.pause(); // åœæ­¢è§†é¢‘æ’­æ”¾
                currentVideo = null;
            }
            document.getElementById('search-page').style.display = 'block';
            document.getElementById('detail-page').style.display = 'none';
        }
    </script>
</body>
</html>
